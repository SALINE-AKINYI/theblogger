<!-- views/user-profile.ejs -->
<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<%- include('includes/head') %>
<body class="d-flex flex-column min-vh-100">
    <%- include('includes/header') %>

    <main class="container py-5 flex-grow-1">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <% if (userProfile) { %>
                   
                    <% if(userProfile.username === loggedInUsername){ %>
                        <div class="d-flex justify-content-between align-items-center">
                           <h2 class=" display-3 text-capitalize">Your Profile</h2> 
                           <div>
                                <a href="/dashboard" class="btn btn-primary btn-lg">Go to Dashboard</a>
                           </div>
                        </div><hr>
                    <% } else { %>
                        <div class="d-flex justify-content-between align-items-center">
                            <h2 class="display-3 text-capitalize"><%= userProfile.username %>'s Profile</h2>
                            <% if(loggedInUsername){ %>
                                <div>
                                    <a href="/chat/conversation/<%= userProfile.id %>" class="btn btn-primary btn-lg chat-btn">
                                        <i class="bi bi-chat-left-text me-2"></i>
                                    </a>
                                </div>
                            <% } else { %>
                                <a class="btn btn-primary text-capitalize" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">Login to text <%= userProfile.username %></a>
                            <% } %> 
                        </div><hr>
                    <% } %> 
                    
                    <h3 class="mt-5 mb-4">Posts (<%= userProfile.posts.length %>)</h3>

                    <% if (userProfile.posts.length > 0) { %>
                        <div class="row row-cols-1 g-4">
                            <% userProfile.posts.forEach(post => { %>
                                <div class="col">
                                    <div class="card shadow-sm h-100">
                                        <div class="card-body">
                                            <h5 class="card-title">
                                                <a href="/post/post/<%= post.id %>" class="text-decoration-none"><%= post.title %></a>
                                            </h5>
                                            <p class="card-text text-muted">
                                                <small>Posted on <%= new Date(post.createdDate).toLocaleString() %></small>
                                            </p>
                                            <p class="card-text">
                                                <%= post.body.substring(0, 150) %>...
                                            </p>
                                            <div class="d-flex justify-content-between align-items-center mt-3">
                                                <div>
                                                    <span class="me-3"><i class="bi bi-heart-fill text-danger"></i> <%= post.likesCount %></span>
                                                    <span><i class="bi bi-chat-dots-fill text-info"></i> <%= post.commentsCount %></span>
                                                </div>
                                                <a href="/post/post/<%= post.id %>" class="btn btn-sm btn-outline-primary">Read More</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% }); %>
                        </div>
                    <% } else { %>
                        <div class="alert alert-info" role="alert">
                            This user has not created any posts yet.
                        </div>
                    <% } %>
                <% } else { %>
                    <div class="alert alert-danger" role="alert">
                        User profile not found.
                    </div>
                <% } %>
            </div>
        </div>
    </main>

    <%- include('includes/footer') %>

    <%-include('includes/loginModal')  %>

    <%-include('includes/registerModal')  %>

    <%-include('includes/adminModal')  %>
</body>
</html>
